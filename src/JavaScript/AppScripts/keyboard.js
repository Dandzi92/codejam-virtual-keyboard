let buttonsArray = [
  {
    datakey: "192",
    value: {
      eng: { uppercase: "~", lowercase: "`" },
      rus: { uppercase: "Ё", lowercase: "ё" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "49",
    value: {
      eng: { uppercase: "!", lowercase: "1" },
      rus: { uppercase: "!", lowercase: "1" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "50",
    value: {
      eng: { uppercase: "@", lowercase: "2" },
      rus: { uppercase: '"', lowercase: "2" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "51",
    value: {
      eng: { uppercase: "#", lowercase: "3" },
      rus: { uppercase: "№", lowercase: "3" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "52",
    value: {
      eng: { uppercase: "$", lowercase: "4" },
      rus: { uppercase: ";", lowercase: "4" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "53",
    value: {
      eng: { uppercase: "%", lowercase: "5" },
      rus: { uppercase: "%", lowercase: "5" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "54",
    value: {
      eng: { uppercase: "^", lowercase: "6" },
      rus: { uppercase: ":", lowercase: "6" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "55",
    value: {
      eng: { uppercase: "&", lowercase: "7" },
      rus: { uppercase: "?", lowercase: "7" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "56",
    value: {
      eng: { uppercase: "*", lowercase: "8" },
      rus: { uppercase: "*", lowercase: "8" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "57",
    value: {
      eng: { uppercase: "(", lowercase: "9" },
      rus: { uppercase: "(", lowercase: "9" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "48",
    value: {
      eng: { uppercase: ")", lowercase: "0" },
      rus: { uppercase: ")", lowercase: "0" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "189",
    value: {
      eng: { uppercase: "_", lowercase: "-" },
      rus: { uppercase: "_", lowercase: "-" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "187",
    value: {
      eng: { uppercase: "+", lowercase: "=" },
      rus: { uppercase: "+", lowercase: "=" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "8",
    value: "Backspace",
    css: { common: "common_keyboard", special: "backspace" },
    type: "service"
  },
  {
    datakey: "9",
    value: "Tab",
    css: { common: "common_keyboard", special: "tab" },
    type: "service"
  },
  {
    datakey: "81",
    value: {
      eng: { uppercase: "Q", lowercase: "q" },
      rus: { uppercase: "Й", lowercase: "й" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "87",
    value: {
      eng: { uppercase: "W", lowercase: "w" },
      rus: { uppercase: "Ц", lowercase: "ц" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "69",
    value: {
      eng: { uppercase: "E", lowercase: "e" },
      rus: { uppercase: "У", lowercase: "у" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "82",
    value: {
      eng: { uppercase: "R", lowercase: "r" },
      rus: { uppercase: "К", lowercase: "к" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "84",
    value: {
      eng: { uppercase: "T", lowercase: "t" },
      rus: { uppercase: "Е", lowercase: "е" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "89",
    value: {
      eng: { uppercase: "Y", lowercase: "y" },
      rus: { uppercase: "Н", lowercase: "н" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "85",
    value: {
      eng: { uppercase: "U", lowercase: "u" },
      rus: { uppercase: "Г", lowercase: "г" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "73",
    value: {
      eng: { uppercase: "I", lowercase: "i" },
      rus: { uppercase: "Ш", lowercase: "ш" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "79",
    value: {
      eng: { uppercase: "O", lowercase: "o" },
      rus: { uppercase: "Щ", lowercase: "щ" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "80",
    value: {
      eng: { uppercase: "P", lowercase: "p" },
      rus: { uppercase: "З", lowercase: "з" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "219",
    value: {
      eng: { uppercase: "{", lowercase: "[" },
      rus: { uppercase: "Х", lowercase: "х" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "221",
    value: {
      eng: { uppercase: "}", lowercase: "]" },
      rus: { uppercase: "Ъ", lowercase: "ъ" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "220",
    value: {
      eng: { uppercase: "|", lowercase: "\\" },
      rus: { uppercase: "/", lowercase: "\\" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "46",
    value: "Del",
    css: { common: "common_keyboard", special: "del" },
    type: "service"
  },
  {
    datakey: "20",
    value: "Caps Lock",
    css: { common: "common_keyboard", special: "caps" },
    type: "service"
  },
  {
    datakey: "65",
    value: {
      eng: { uppercase: "A", lowercase: "a" },
      rus: { uppercase: "Ф", lowercase: "ф" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "83",
    value: {
      eng: { uppercase: "S", lowercase: "s" },
      rus: { uppercase: "Ы", lowercase: "ы" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "68",
    value: {
      eng: { uppercase: "D", lowercase: "d" },
      rus: { uppercase: "В", lowercase: "в" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "70",
    value: {
      eng: { uppercase: "F", lowercase: "f" },
      rus: { uppercase: "А", lowercase: "а" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "71",
    value: {
      eng: { uppercase: "G", lowercase: "g" },
      rus: { uppercase: "П", lowercase: "п" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "72",
    value: {
      eng: { uppercase: "H", lowercase: "h" },
      rus: { uppercase: "Р", lowercase: "р" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "74",
    value: {
      eng: { uppercase: "J", lowercase: "j" },
      rus: { uppercase: "О", lowercase: "о" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "75",
    value: {
      eng: { uppercase: "K", lowercase: "k" },
      rus: { uppercase: "Л", lowercase: "л" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "76",
    value: {
      eng: { uppercase: "L", lowercase: "l" },
      rus: { uppercase: "Д", lowercase: "д" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "186",
    value: {
      eng: { uppercase: ":", lowercase: ";" },
      rus: { uppercase: "Ж", lowercase: "ж" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "222",
    value: {
      eng: { uppercase: '"', lowercase: "'" },
      rus: { uppercase: "Э", lowercase: "э" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "13",
    value: "Enter",
    css: { common: "common_keyboard", special: "enter" },
    type: "service"
  },
  {
    datacode: 'ShiftLeft',
    datakey: "16",
    value: "Shift",
    css: { common: "common_keyboard", special: "shift" },
    type: "service"
  },
  {
    datakey: "90",
    value: {
      eng: { uppercase: "Z", lowercase: "z" },
      rus: { uppercase: "Я", lowercase: "я" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "88",
    value: {
      eng: { uppercase: "X", lowercase: "x" },
      rus: { uppercase: "Ч", lowercase: "ч" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "67",
    value: {
      eng: { uppercase: "C", lowercase: "c" },
      rus: { uppercase: "С", lowercase: "с" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "86",
    value: {
      eng: { uppercase: "V", lowercase: "v" },
      rus: { uppercase: "М", lowercase: "м" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "66",
    value: {
      eng: { uppercase: "B", lowercase: "b" },
      rus: { uppercase: "И", lowercase: "и" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "78",
    value: {
      eng: { uppercase: "N", lowercase: "n" },
      rus: { uppercase: "Т", lowercase: "т" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "77",
    value: {
      eng: { uppercase: "M", lowercase: "m" },
      rus: { uppercase: "Ь", lowercase: "ь" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "188",
    value: {
      eng: { uppercase: "<", lowercase: "," },
      rus: { uppercase: "Б", lowercase: "б" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "190",
    value: {
      eng: { uppercase: ">", lowercase: "." },
      rus: { uppercase: "Ю", lowercase: "ю" }
    },
    css: "common_keyboard"
  },
  {
    datakey: "191",
    value: {
      eng: { uppercase: "?", lowercase: "/" },
      rus: { uppercase: ",", lowercase: "." }
    },
    css: "common_keyboard"
  },
  {
    datakey: "38",
    value: "up",
    css: { common: "common_keyboard", special: "up" },
    type: "service"
  },
  {
    datacode: 'ShiftRight',
    datakey: "16",
    value: "Shift",
    css: { common: "common_keyboard", special: "shift" },
    type: "service"
  },

  {
    datacode: 'ControlLeft',
    datakey: "17",
    value: "Ctrl",
    css: { common: "common_keyboard", special: "ctrl" },
    type: "service"
  },
  {
    datakey: "91",
    value: "Win",
    css: { common: "common_keyboard" },
    type: "service"
  },
  {
    datacode: 'AltLeft',
    datakey: "18",
    value: "Alt",
    css: { common: "common_keyboard" },
    type: "service"
  },
  {
    datakey: "32",
    value: "Space",
    css: { common: "common_keyboard", special: "space" },
    type: "service"
  },
  {
    datacode: 'AltRight',
    datakey: "18",
    value: "Alt",
    css: { common: "common_keyboard" },
    type: "service"
  },
  {
    datakey: "37",
    value: "left",
    css: { common: "common_keyboard", special: "left" },
    type: "service"
  },
  {
    datakey: "40",
    value: "down",
    css: { common: "common_keyboard", special: "down" },
    type: "service"
  },
  {
    datakey: "39",
    value: "right",
    css: { common: "common_keyboard", special: "right" },
    type: "service"
  },
  {
    datacode: 'ControlRight',
    datakey: "17",
    value: "Ctrl",
    css: { common: "common_keyboard", special: "ctrl" },
    type: "service"
  }
];

let wrapper = document.createElement("div");
wrapper.className = "wrapper";
let input = document.createElement("textarea");
input.className = "input";
input.setAttribute("disabled", "disabled");
wrapper.insertAdjacentElement("beforeend", input);
let keyPad = document.createElement("div");
keyPad.className = "keypad";
wrapper.insertAdjacentElement("beforeend", keyPad);
document.body.append(wrapper);

let buttonContainer;
let localStorageLang;
let keysLang;
let keysCase = "lowercase";
localStorageLang = localStorage.getItem("myLang");

if (!localStorageLang) {
  keysLang = "rus";
} else {
  keysLang = localStorageLang;
}

buttonsArray.forEach(button => {
  buttonContainer = document.createElement("div");
  if (button.datacode) {
    buttonContainer.setAttribute("data-code", button.datacode);
  }
  buttonContainer.setAttribute("data-key", button.datakey);
  if (button.type == "service") {
    buttonContainer.innerText = button.value;
    for (var key in button.css) {
      buttonContainer.classList.add(button.css[key]);
    }
  } else {
    if (!localStorageLang) {
      buttonContainer.innerText = button.value[keysLang].lowercase;
      localStorage.setItem("myLang", keysLang);
    } else {
      buttonContainer.innerText = button.value[localStorageLang].lowercase;
    }
    buttonContainer.className = button.css;
  }
  keyPad.insertAdjacentElement("beforeend", buttonContainer);
});

const allKeys = Array.from(document.querySelectorAll(".common_keyboard"));

allKeys.forEach(key => key.addEventListener("transitionend", removeTransition));

keyPad.addEventListener("click", clickKeyboard);
keyPad.addEventListener("mousedown", clickShiftDown);
keyPad.addEventListener("mouseup", clickShiftUp);
window.addEventListener("keydown", pushKeypad);
window.addEventListener("keydown", changeLang);
window.addEventListener("keydown", shiftDown);
window.addEventListener("keyup", shiftUp);

function clickKeyboard(e) {
  if (!Array.from(e.target.classList).includes('common_keyboard')) {return}
  e.target.classList.add("active");
  let keyValue = e.target.innerText;
  clicksPushesHandler(keyValue);
}
function clickShiftDown(e) {
  if (e.target.innerText == "Shift") {
    changeCase();
  }
}
function clickShiftUp(e) {
  if (e.target.innerText == "Shift") {
    changeCase();
  }
}
function pushKeypad(e) {
  let key;
  if (e.keyCode == 16 || e.keyCode == 18 || e.keyCode == 17) {
    key = document.querySelector(`div[data-code="${e.code}"]`)
  }
  else {key = document.querySelector(`div[data-key="${e.keyCode}"]`)}
  let keyValue = key.innerText;
  clicksPushesHandler(keyValue);
  key.classList.add("active");
}
function clicksPushesHandler(value) {
  switch (value) {
    case "Space":
      input.innerHTML += " ";
      break;
    case "Backspace":
      let temper = input.defaultValue.split("");
      temper.pop();
      input.innerHTML = temper.join("");
      break;
    case "Tab":
      input.innerHTML += "\t";
      break;
    case "Enter":
      input.innerHTML += "\n";
      break;
    case "Caps Lock":
      changeCase();
      break;
    case "Shift":
    case "Alt":
    case "Ctrl":
    case 'up':
    case 'down':
    case 'left':
    case 'right':
    case 'Win':
    case 'Del':
      break;
    default:
      input.innerHTML += value;
  }
}
function removeTransition(e) {
  if (e.propertyName !== "transform") return;
  e.target.classList.remove("active");
}
function changeLang(e) {
  if (e.ctrlKey && e.altKey) {
    
    allKeys.forEach(domButton => {
      for (let i = 0; i < buttonsArray.length; i++) {
        if (
          !buttonsArray[i].type &&
          domButton.innerText === buttonsArray[i].value[keysLang][keysCase]
        ) {
          if (keysLang === "eng") {
            domButton.innerText = buttonsArray[i].value.rus[keysCase];
          } else {
            domButton.innerText = buttonsArray[i].value.eng[keysCase];
          }
          break;
        }
      }
    });
    if (keysLang === "eng") {
      keysLang = "rus";
      localStorage.setItem("myLang", keysLang);
    } else {
      keysLang = "eng";
      localStorage.setItem("myLang", keysLang);
    }
  }
}
function changeCase () {
  if (keysCase == "uppercase") {
    buttonsArray.forEach(button => {
      allKeys.forEach(domButton => {
        if (
          !button.type &&
          domButton.innerText === button.value[keysLang].uppercase
        ) {
          domButton.innerText = button.value[keysLang].lowercase;
          keysCase = "lowercase";
        }
      });
    });
  } else {
    buttonsArray.forEach(button => {
      allKeys.forEach(domButton => {
        if (
          !button.type &&
          domButton.innerText === button.value[keysLang].lowercase
        ) {
          domButton.innerText = button.value[keysLang].uppercase;
          keysCase = "uppercase";
        }
      });
    });
  }
}
function shiftDown (e) {
  if (e.key == "Shift" && !e.repeat) {
    changeCase();
  }
}
function shiftUp (e) {
  if (e.key == "Shift") {
    changeCase()
  }
}


